import{u as le}from"./app-CQto9ei9.js";import{_ as oe,V as O,a as B,d as se,b as U}from"./VCard-BwZTtDha.js";import{N as R,l as w,a1 as q,e as a,f as y,a5 as F,w as t,o as v,h as o,V as re,a4 as p,i,j as G,L as H}from"./index-x0uWx8_N.js";import{g as _}from"./VSelect-DAPLtHuN.js";import{V as K,a as n,b as d,c as $,d as ue}from"./VList-Dtj1b0B-.js";import{V as S}from"./VAvatar-BnXmNYTE.js";import{V as A,a as L}from"./VRow-C7L0s5NK.js";import{V as Q}from"./VSlider-Y_Ro81Gi.js";import{V as X}from"./VTooltip-CsjF_WRv.js";import"./forwardRefs-DdXr6tAt.js";const ie={class:"calculation-methods"},ne={class:"text-body-1 mb-4"},de={class:"text-body-1 mb-4"},pe={class:"text-body-2"},me={key:0,class:"mb-4"},fe={__name:"calculations",setup(ve){const m=le(),j=R(m.$state.selectedCalculationMethod),z=R(0),N=R(1),D=R(m.$state.variables.profitMargin*100),E=R(m.$state.variables.overheadRate*100),Y=w(()=>m.$state.calculationMethods),f=w(()=>m.$state.calculationMethods.find(s=>s.id===j.value)),I=w(()=>m.$state.jobs),u=w(()=>m.$state.variables),Z=w(()=>{const s=m.$state.serviceTierScales[m.$state.selectedServiceTierScale];return Object.entries(s.values).filter(([e])=>!isNaN(parseFloat(e))).map(([e,l])=>{const r=parseInt(e);return{title:h(r)+` (${l}x)`,value:r}}).sort((e,l)=>e.value-l.value)});function h(s){return{1:"Band-Aid",2:"Bronze",3:"Silver",4:"Gold",5:"Platinum"}[s]||`Tier ${s}`}function J(s,e){if(!s||e===void 0||e===null||e===1)return 1;const l=parseFloat(e)||1;if(l===1)return 1;const r={low:l*.9,medium:l,high:l*1.1};return r[s]!==void 0?r[s]:l}const P=w(()=>I.value[z.value]||I.value[0]),W=w(()=>m.$state.serviceTierScales[m.$state.selectedServiceTierScale].values[N.value]||1),V=w(()=>{if(!P.value)return null;const s=P.value,e=W.value,l={};switch(j.value){case"standard":{const r=s.material*u.value.salesTax;let c=1;const b=Object.entries(m.$state.markupScales[m.$state.selectedMarkupScale].values).map(([C,T])=>[parseFloat(C.slice(1).replace(",","")),T]).sort((C,T)=>C[0]-T[0]);for(const[C,T]of b)r>=C&&(c=T);l.matCost=r,l.matMarkup=c;const x=u.value.warrantyFactor||0,g=r*c*x*e,k=s.requiresCertification&&u.value.certificationBonus||0,M=J(s.seasonalDemand,u.value.seasonalAdjustment);l.matFee=r*c*e*M,l.laborFee=s.hours*u.value.hourlyLaborFee*e,l.warrantyFee=g,l.certificationFee=k,l.totalFee=l.matFee+l.laborFee+u.value.diagnosticFee+g+k;break}case"cost-plus":{const r=s.material*u.value.salesTax,c=s.hours*u.value.hourlyLaborFee,b=.4,x=.65,g=u.value.warrantyFactor||0,k=r*(1+b)*g*e,M=s.requiresCertification&&u.value.certificationBonus||0,C=J(s.seasonalDemand,u.value.seasonalAdjustment);l.matCost=r,l.matMarkup=(1+b).toFixed(2),l.matFee=r*(1+b)*e*C,l.laborFee=c*(1+x)*e,l.warrantyFee=k,l.certificationFee=M,l.totalFee=l.matFee+l.laborFee+u.value.diagnosticFee+k+M;break}case"profit-based":{const r=s.material*u.value.salesTax,c=s.hours*u.value.hourlyLaborCost,b=r+c,x=b*u.value.overheadRate,g=(b+x)*u.value.profitMargin,k=b*(e-1);l.matCost=r,l.matMarkup=(1+u.value.overheadRate+u.value.profitMargin).toFixed(2),l.overhead=x,l.profit=g;const M=b*(1+u.value.overheadRate+u.value.profitMargin),C=r/b,T=c/b;l.matFee=M*C,l.laborFee=M*T+k,l.totalFee=b+x+g+k+u.value.diagnosticFee;break}case"value-based":{const r=s.material*u.value.salesTax;let c=1;const b=Object.entries(m.$state.markupScales[m.$state.selectedMarkupScale].values).map(([k,M])=>[parseFloat(k.slice(1).replace(",","")),M]).sort((k,M)=>k[0]-M[0]);for(const[k,M]of b)r>=k&&(c=M);const x=s.complexity||1,g=s.emergencyFactor||1;l.matCost=r,l.matMarkup=c,l.matFee=r*c*e*x,l.laborFee=s.hours*u.value.hourlyLaborFee*e*g,l.totalFee=l.matFee+l.laborFee+u.value.diagnosticFee;break}default:{const r=s.material*u.value.salesTax;let c=1;const b=Object.entries(m.$state.markupScales[m.$state.selectedMarkupScale].values).map(([x,g])=>[parseFloat(x.slice(1).replace(",","")),g]).sort((x,g)=>x[0]-g[0]);for(const[x,g]of b)r>=x&&(c=g);l.matCost=r,l.matMarkup=c,l.matFee=r*c*e,l.laborFee=s.hours*u.value.hourlyLaborFee*e,l.totalFee=l.matFee+l.laborFee+u.value.diagnosticFee}}return l});function ee(s){m.setCalculationMethod(s)}function te(s){const e=s/100;m.updateVariable("profitMargin",e)}function ae(s){const e=s/100;m.updateVariable("overheadRate",e)}return(s,e)=>(v(),q("div",ie,[a(O,{class:"mb-4 px-4 py-2"},{default:t(()=>[a(B,{class:"text-h5 d-flex align-center"},{default:t(()=>[a(re,{icon:"mdi-arrow-left",variant:"text",size:"small",to:{name:"admin"},class:"mr-2"}),e[5]||(e[5]=o(" Calculation Methods "))]),_:1}),a(se,null,{default:t(()=>e[6]||(e[6]=[o("Choose and understand different pricing calculation methods")])),_:1})]),_:1}),a(O,{class:"mb-4"},{default:t(()=>[a(B,null,{default:t(()=>e[7]||(e[7]=[o("Select Calculation Method")])),_:1}),a(U,null,{default:t(()=>[a(_,{modelValue:j.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>j.value=l),ee],items:Y.value,"item-title":"name","item-value":"id",label:"Price Calculation Method"},null,8,["modelValue","items"])]),_:1})]),_:1}),f.value?(v(),y(O,{key:0,class:"mb-4"},{default:t(()=>[a(B,null,{default:t(()=>[o(p(f.value.name),1)]),_:1}),a(U,null,{default:t(()=>[e[30]||(e[30]=i("h3",{class:"text-subtitle-1 font-weight-bold mb-2"}," Description ",-1)),i("p",ne,p(f.value.description),1),e[31]||(e[31]=i("h3",{class:"text-subtitle-1 font-weight-bold mb-2"}," Why Use This Method? ",-1)),i("p",de,p(f.value.explanation),1),e[32]||(e[32]=i("h3",{class:"text-subtitle-1 font-weight-bold mb-2"}," Formula ",-1)),a(O,{variant:"outlined",class:"pa-3 bg-grey-lighten-4 mb-4"},{default:t(()=>[i("pre",pe,p(f.value.formula),1)]),_:1}),e[33]||(e[33]=i("h3",{class:"text-subtitle-1 font-weight-bold mb-3"}," Variables Used ",-1)),a(O,{variant:"outlined",class:"mb-4"},{default:t(()=>[a(K,{density:"compact",lines:"two"},{default:t(()=>[f.value.id==="standard"?(v(),y(n,{key:0},{prepend:t(()=>[a(S,{color:"primary",size:"small"},{default:t(()=>e[8]||(e[8]=[o(" M ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>e[9]||(e[9]=[o("Material Markup")])),_:1}),a($,null,{default:t(()=>e[10]||(e[10]=[o("Determines the markup based on material cost threshold")])),_:1})]),_:1})):F("",!0),f.value.id==="cost-plus"?(v(),y(n,{key:1},{prepend:t(()=>[a(S,{color:"primary",size:"small"},{default:t(()=>e[11]||(e[11]=[o(" M ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>e[12]||(e[12]=[o("Material Markup (40%)")])),_:1}),a($,null,{default:t(()=>e[13]||(e[13]=[o("Fixed percentage added to material costs")])),_:1})]),_:1})):F("",!0),f.value.id==="cost-plus"?(v(),y(n,{key:2},{prepend:t(()=>[a(S,{color:"orange",size:"small"},{default:t(()=>e[14]||(e[14]=[o(" L ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>e[15]||(e[15]=[o("Labor Markup (65%)")])),_:1}),a($,null,{default:t(()=>e[16]||(e[16]=[o("Fixed percentage added to labor costs")])),_:1})]),_:1})):F("",!0),f.value.id==="profit-based"?(v(),y(n,{key:3},{prepend:t(()=>[a(S,{color:"success",size:"small"},{default:t(()=>e[17]||(e[17]=[o(" P ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>[o("Profit Margin ("+p((u.value.profitMargin*100).toFixed(0))+"%)",1)]),_:1}),a($,null,{default:t(()=>e[18]||(e[18]=[o("Target profit percentage applied to costs plus overhead")])),_:1})]),_:1})):F("",!0),f.value.id==="profit-based"?(v(),y(n,{key:4},{prepend:t(()=>[a(S,{color:"info",size:"small"},{default:t(()=>e[19]||(e[19]=[o(" O ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>[o("Overhead Rate ("+p((u.value.overheadRate*100).toFixed(0))+"%)",1)]),_:1}),a($,null,{default:t(()=>e[20]||(e[20]=[o("Percentage added to cover business overhead costs")])),_:1})]),_:1})):F("",!0),f.value.id==="value-based"?(v(),y(n,{key:5},{prepend:t(()=>[a(S,{color:"warning",size:"small"},{default:t(()=>e[21]||(e[21]=[o(" C ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>e[22]||(e[22]=[o("Complexity Factor")])),_:1}),a($,null,{default:t(()=>e[23]||(e[23]=[o("Job-specific factor that affects material costs (set per job)")])),_:1})]),_:1})):F("",!0),f.value.id==="value-based"?(v(),y(n,{key:6},{prepend:t(()=>[a(S,{color:"error",size:"small"},{default:t(()=>e[24]||(e[24]=[o(" E ")])),_:1})]),default:t(()=>[a(d,null,{default:t(()=>e[25]||(e[25]=[o("Emergency Factor")])),_:1}),a($,null,{default:t(()=>e[26]||(e[26]=[o("Job-specific factor that affects labor costs (set per job)")])),_:1})]),_:1})):F("",!0)]),_:1})]),_:1}),f.value.id==="profit-based"?(v(),q("div",me,[e[29]||(e[29]=i("h3",{class:"text-subtitle-1 font-weight-bold mb-2"}," Adjust Profit & Overhead ",-1)),a(A,null,{default:t(()=>[a(L,{cols:"12",sm:"6"},{default:t(()=>[a(Q,{modelValue:D.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>D.value=l),te],min:10,max:50,step:1,"show-ticks":"always","thumb-label":"",label:"Profit Margin (%)"},{append:t(()=>[a(X,{location:"end","content-class":"tooltip-bright"},{activator:t(({props:l})=>[a(G,H({icon:"mdi-information-outline",color:"info",size:"small"},l),null,16)]),default:t(()=>[e[27]||(e[27]=i("div",{class:"pa-3",style:{"max-width":"300px"}},[i("p",{class:"mb-2"},[i("strong",null,"Profit Margin")]),i("p",null,"This is the target profit percentage applied to the sum of base costs plus overhead."),i("p",{class:"mt-2 text-caption"}," Formula: Profit = (Base Cost + Overhead) × Profit Margin "),i("p",{class:"text-caption"}," Typical values: 15-30% ")],-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(L,{cols:"12",sm:"6"},{default:t(()=>[a(Q,{modelValue:E.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>E.value=l),ae],min:5,max:30,step:1,"show-ticks":"always","thumb-label":"",label:"Overhead Rate (%)"},{append:t(()=>[a(X,{location:"end","content-class":"tooltip-bright"},{activator:t(({props:l})=>[a(G,H({icon:"mdi-information-outline",color:"info",size:"small"},l),null,16)]),default:t(()=>[e[28]||(e[28]=i("div",{class:"pa-3",style:{"max-width":"300px"}},[i("p",{class:"mb-2"},[i("strong",null,"Overhead Rate")]),i("p",null,"The percentage added to cover business overhead costs like rent, utilities, office staff, etc."),i("p",{class:"mt-2 text-caption"}," Formula: Overhead = Base Cost × Overhead Rate "),i("p",{class:"text-caption"}," Typical values: 10-20% ")],-1))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])):F("",!0)]),_:1})]),_:1})):F("",!0),a(O,{class:"mb-4"},{default:t(()=>[a(B,null,{default:t(()=>e[34]||(e[34]=[o("Sample Calculation")])),_:1}),a(U,null,{default:t(()=>[a(A,null,{default:t(()=>[a(L,{cols:"12",sm:"6"},{default:t(()=>[a(_,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=l=>z.value=l),items:I.value.map((l,r)=>({title:l.title,value:r})),"item-title":"title","item-value":"value",label:"Sample Job",density:"compact"},null,8,["modelValue","items"])]),_:1}),a(L,{cols:"12",sm:"6"},{default:t(()=>[a(_,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=l=>N.value=l),items:Z.value,label:"Service Tier",density:"compact"},null,8,["modelValue","items"])]),_:1})]),_:1}),a(ue,{class:"my-4"}),V.value?(v(),y(A,{key:0},{default:t(()=>[a(L,{cols:"12",sm:"6"},{default:t(()=>[e[40]||(e[40]=i("div",{class:"text-caption"}," Input Values ",-1)),a(K,{density:"compact"},{default:t(()=>[a(n,null,{append:t(()=>[o(" $"+p(P.value.material.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[35]||(e[35]=[o("Base Material Cost")])),_:1})]),_:1}),a(n,null,{append:t(()=>[o(p(P.value.hours),1)]),default:t(()=>[a(d,null,{default:t(()=>e[36]||(e[36]=[o("Hours")])),_:1})]),_:1}),f.value.id==="value-based"?(v(),y(n,{key:0},{append:t(()=>[o(p(P.value.complexity),1)]),default:t(()=>[a(d,null,{default:t(()=>e[37]||(e[37]=[o("Complexity Factor")])),_:1})]),_:1})):F("",!0),f.value.id==="value-based"?(v(),y(n,{key:1},{append:t(()=>[o(p(P.value.emergencyFactor),1)]),default:t(()=>[a(d,null,{default:t(()=>e[38]||(e[38]=[o("Emergency Factor")])),_:1})]),_:1})):F("",!0),a(n,null,{append:t(()=>[o(p(W.value)+"x ",1)]),default:t(()=>[a(d,null,{default:t(()=>e[39]||(e[39]=[o("Tier Multiplier")])),_:1})]),_:1})]),_:1})]),_:1}),a(L,{cols:"12",sm:"6"},{default:t(()=>[e[51]||(e[51]=i("div",{class:"text-caption"}," Calculation Result ",-1)),a(K,{density:"compact"},{default:t(()=>[a(n,null,{append:t(()=>[o(" $"+p(V.value.matCost.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[41]||(e[41]=[o("Material Cost (w/tax)")])),_:1})]),_:1}),f.value.id==="standard"||f.value.id==="value-based"?(v(),y(n,{key:0},{append:t(()=>[o(p(V.value.matMarkup)+"x ",1)]),default:t(()=>[a(d,null,{default:t(()=>e[42]||(e[42]=[o("Material Markup")])),_:1})]),_:1})):F("",!0),f.value.id==="profit-based"?(v(),y(n,{key:1},{append:t(()=>[o(" $"+p(V.value.overhead.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[43]||(e[43]=[o("Overhead")])),_:1})]),_:1})):F("",!0),f.value.id==="profit-based"?(v(),y(n,{key:2},{append:t(()=>[o(" $"+p(V.value.profit.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[44]||(e[44]=[o("Profit")])),_:1})]),_:1})):F("",!0),a(n,null,{append:t(()=>[o(" $"+p(V.value.matFee.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[45]||(e[45]=[o("Material Fee")])),_:1})]),_:1}),a(n,null,{append:t(()=>[o(" $"+p(V.value.laborFee.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[46]||(e[46]=[o("Labor Fee")])),_:1})]),_:1}),V.value.warrantyFee?(v(),y(n,{key:3},{append:t(()=>[o(" $"+p(V.value.warrantyFee.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[47]||(e[47]=[o("Warranty Protection")])),_:1})]),_:1})):F("",!0),V.value.certificationFee>0?(v(),y(n,{key:4},{append:t(()=>[o(" $"+p(V.value.certificationFee.toFixed(2)),1)]),default:t(()=>[a(d,null,{default:t(()=>e[48]||(e[48]=[o("Certification Fee")])),_:1})]),_:1})):F("",!0),a(n,null,{append:t(()=>{var l,r;return[o(" $"+p(((r=(l=u.value.value)==null?void 0:l.diagnosticFee)==null?void 0:r.toFixed(2))||"0.00"),1)]}),default:t(()=>[a(d,null,{default:t(()=>e[49]||(e[49]=[o("Diagnostic Fee")])),_:1})]),_:1}),a(n,null,{append:t(()=>[o(" $"+p(V.value.totalFee.toFixed(2)),1)]),default:t(()=>[a(d,{class:"text-subtitle-1 font-weight-bold"},{default:t(()=>e[50]||(e[50]=[o(" Total Fee ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1})]),_:1})]))}},Te=oe(fe,[["__scopeId","data-v-5b6d2a09"]]);export{Te as default};
