import{bd as A}from"./index-x0uWx8_N.js";function F(e,a){if(!e||a===void 0||a===null||a===1)return 1;const r=parseFloat(a)||1;if(r===1)return 1;const o={low:r*.9,medium:r,high:r*1.1};return o[e]!==void 0?o[e]:r}function S(e,a){if(!e||!a||!a.length)return 1;for(const[i,l]of a)if(e===i)return l;const r=[...a].sort((i,l)=>l[0]-i[0]);for(const[i,l]of r)if(e>=i)return l;return a.reduce((i,l)=>l[0]<i[0]?l:i,a[0])[1]}function M(e,a,r){if(e===void 0||a===void 0||a===0||r===void 0)return 0;const o=parseFloat(a)||0,i=parseFloat(r)||1;return(parseFloat(e)||0)*o*i}function j(e,a){return!e||!a?0:parseFloat(a)||0}const q=A("app",{state:()=>{const e=localStorage.getItem("menuPriceAppState");if(e)try{const a=JSON.parse(e);return a.jobCategories||(a.jobCategories=[{id:1,name:"Plumbing",color:"blue"},{id:2,name:"Electrical",color:"amber"},{id:3,name:"HVAC",color:"green"},{id:4,name:"Appliance",color:"red"}]),a}catch(a){console.error("Failed to parse saved state:",a)}return{variables:{salesTax:1.07,hourlyLaborFee:200,hourlyLaborCost:30,diagnosticFee:30,profitMargin:.25,overheadRate:.15,materialMarkup:.4,laborMarkup:.65,warrantyFactor:.1,seasonalAdjustment:1,emergencyRate:1.5,certificationBonus:0,materialInflation:0,customerDiscount:0,minimumJobFee:75},analytics:{totalJobsCompleted:84,totalRevenue:45250.75,averageJobValue:538.7,topCategory:"Plumbing",topJob:"Drain Cleaning Interior",preferredTier:3,preferredCalculation:"standard",profitMargins:{standard:.32,"cost-plus":.28,"profit-based":.25,"value-based":.35},categoryDistribution:{Plumbing:65,Electrical:19,HVAC:0,Appliance:0},jobHistory:[{date:"2025-04-01",count:2,revenue:845.5},{date:"2025-04-02",count:3,revenue:1250.75},{date:"2025-04-03",count:5,revenue:2845.25},{date:"2025-04-04",count:4,revenue:2150},{date:"2025-04-05",count:6,revenue:3522.75},{date:"2025-04-06",count:2,revenue:1125.5},{date:"2025-04-07",count:3,revenue:1850.25},{date:"2025-04-08",count:4,revenue:2245},{date:"2025-04-09",count:5,revenue:2750.5},{date:"2025-04-10",count:7,revenue:4125.75},{date:"2025-04-11",count:6,revenue:3950.25},{date:"2025-04-12",count:5,revenue:2845},{date:"2025-04-13",count:4,revenue:2215.5},{date:"2025-04-14",count:8,revenue:4825.75},{date:"2025-04-15",count:6,revenue:3245.5},{date:"2025-04-16",count:7,revenue:3825.25},{date:"2025-04-17",count:7,revenue:3632.25}]},markupScales:[{name:"OG From Plumbing Service Spreadsheet",values:{"$0.00":4,"$5.00":3.5,"$10.00":3,"$20.00":2.75,"$40.00":2.5,"$60.00":2.25,"$100.00":2,"$150.00":1.75,"$250.00":1.65}},{name:"A Flat Scale",values:{"$0.00":2.5,"$5.00":2.5,"$10.00":2.5,"$20.00":2.5,"$40.00":2.5,"$60.00":2.5,"$100.00":2.5,"$150.00":2.5,"$250.00":2.5}},{name:"Premium Service Scale",values:{"$0.00":5,"$5.00":4.5,"$10.00":4,"$20.00":3.75,"$40.00":3.5,"$60.00":3.25,"$100.00":3,"$150.00":2.75,"$250.00":2.5}},{name:"Economy Scale",values:{"$0.00":3,"$5.00":2.75,"$10.00":2.5,"$20.00":2.25,"$40.00":2,"$60.00":1.85,"$100.00":1.7,"$150.00":1.5,"$250.00":1.35}},{name:"Commercial Projects Scale",values:{"$0.00":3.5,"$25.00":3,"$50.00":2.5,"$100.00":2,"$250.00":1.8,"$500.00":1.65,"$1000.00":1.5,"$2500.00":1.4,"$5000.00":1.3}}],selectedMarkupScale:0,serviceTierScales:[{name:"Normal From Plumbing Spreadsheet",values:{1:1,2:1.5,3:2,4:2.5,5:3}},{name:"More Aggressive",values:{1:1,2:2,3:3,4:4,5:5}},{name:"Premium Focus",values:{1:1,2:1.75,3:2.5,4:3.5,5:4.5}},{name:"Economy Focus",values:{1:1,2:1.25,3:1.5,4:1.75,5:2}},{name:"Market-Based",values:{1:1,2:1.35,3:1.85,4:2.25,5:2.75}}],selectedServiceTierScale:0,jobCategories:[{id:1,name:"Plumbing",color:"blue"},{id:2,name:"Electrical",color:"amber"},{id:3,name:"HVAC",color:"green"},{id:4,name:"Appliance",color:"red"}],jobs:[{id:1,title:"Drain Cleaning Interior",material:34.85,hours:.5,complexity:1,emergencyFactor:1,requiresCertification:!1,seasonalDemand:"low",categoryId:1,usageCount:15,lastUsed:"2025-04-10T15:30:00Z",tierSelections:{1:2,2:5,3:6,4:2,5:0}},{id:2,title:"Main Line Drain Cleaning Exterior",material:150,hours:2,complexity:2,emergencyFactor:1.5,requiresCertification:!1,seasonalDemand:"medium",categoryId:1,usageCount:8,lastUsed:"2025-04-14T10:15:00Z",tierSelections:{1:1,2:2,3:3,4:1,5:1}},{id:3,title:"Slow Drain Chemical Cleaning",material:50,hours:2.5,complexity:1.5,emergencyFactor:1.2,requiresCertification:!1,seasonalDemand:"low",categoryId:1,usageCount:12,lastUsed:"2025-04-15T14:20:00Z",tierSelections:{1:3,2:4,3:3,4:2,5:0}},{id:4,title:"Water Heater Replacement",material:450,hours:3.5,complexity:2.5,emergencyFactor:2,requiresCertification:!0,seasonalDemand:"high",categoryId:1,usageCount:7,lastUsed:"2025-04-12T09:45:00Z",tierSelections:{1:0,2:1,3:2,4:3,5:1}},{id:5,title:"Toilet Replacement",material:200,hours:1.5,complexity:1.5,emergencyFactor:1.3,requiresCertification:!1,seasonalDemand:"medium",categoryId:1,usageCount:10,lastUsed:"2025-04-16T11:30:00Z",tierSelections:{1:1,2:3,3:4,4:2,5:0}},{id:6,title:"Faucet Installation",material:120,hours:1,complexity:1.2,emergencyFactor:1.1,requiresCertification:!1,seasonalDemand:"low",categoryId:1,usageCount:14,lastUsed:"2025-04-17T08:20:00Z",tierSelections:{1:2,2:5,3:5,4:2,5:0}},{id:7,title:"Circuit Breaker Replacement",material:75,hours:1.5,complexity:2,emergencyFactor:1.8,requiresCertification:!0,seasonalDemand:"medium",categoryId:2,usageCount:6,lastUsed:"2025-04-15T13:40:00Z",tierSelections:{1:1,2:2,3:2,4:1,5:0}},{id:8,title:"Light Fixture Installation",material:120,hours:1,complexity:1.2,emergencyFactor:1,requiresCertification:!0,seasonalDemand:"low",categoryId:2,usageCount:9,lastUsed:"2025-04-16T15:10:00Z",tierSelections:{1:2,2:3,3:3,4:1,5:0}},{id:9,title:"Outlet Replacement",material:25,hours:.5,complexity:1,emergencyFactor:1.1,requiresCertification:!0,seasonalDemand:"low",categoryId:2,usageCount:11,lastUsed:"2025-04-17T10:05:00Z",tierSelections:{1:3,2:5,3:2,4:1,5:0}},{id:10,title:"Whole House Rewiring",material:2500,hours:24,complexity:3,emergencyFactor:1.5,requiresCertification:!0,seasonalDemand:"medium",categoryId:2,usageCount:2,lastUsed:"2025-04-10T09:00:00Z",tierSelections:{1:0,2:0,3:1,4:1,5:0}}],selectedJob:0,nextJobId:4,timeCostScale:1,matCostScale:1,calculationMethods:[{id:"standard",name:"Standard Material Markup",description:"The original formula from the plumbing service spreadsheet. It applies a tiered material markup based on cost thresholds, and multiplies both material and labor by service tier. Material costs are taxed before markup is applied.",explanation:"This model is widely used in the plumbing and service industries because it allows for transparent pricing while ensuring profitability across all job types. Lower-cost materials have a higher markup percentage to ensure minimum profitability on small jobs, while the markup percentage decreases as material costs increase to remain competitive on larger jobs.",formula:`Material Fee = Material Cost × Tax × Scale × Markup × Tier
Labor Fee = Hours × Hourly Rate × Scale × Tier
Total Fee = Material Fee + Labor Fee + Diagnostic Fee`},{id:"cost-plus",name:"Cost-Plus Model",description:"A cost-plus pricing approach that adds fixed percentage markups to both labor and materials, regardless of material cost. It uses different markup percentages for materials vs. labor.",explanation:"Cost-plus pricing is popular in contracting and construction industries because of its simplicity and clear structure. It typically uses different markup percentages for materials (30-50%) versus labor (50-100%). The consistency makes it easier to explain to customers and simpler to implement across different job types. This model works best for businesses with predictable costs and stable market demand.",formula:`Material Fee = Material Cost × Tax × Scale × (1 + Material Markup) × Tier
Labor Fee = Hours × Hourly Rate × Scale × (1 + Labor Markup) × Tier
Total Fee = Material Fee + Labor Fee + Diagnostic Fee`,materialMarkup:.4,laborMarkup:.65},{id:"profit-based",name:"Profit-Based Pricing",description:"This method calculates prices based on target profit margins. It adds overhead and profit percentages to both material and labor costs.",explanation:"Profit-based pricing is favored by larger service businesses that need to account for substantial overhead costs beyond direct materials and labor. This approach first calculates the true costs (including overhead allocation), then adds a profit margin on top. It's particularly effective for businesses that want consistent profitability percentages across different job types and sizes, and allows for easier financial planning and forecasting.",formula:`Base Cost = (Material Cost × Tax × Scale) + (Hours × Labor Cost × Scale)
Overhead = Base Cost × Overhead Rate
Profit = (Base Cost + Overhead) × Profit Margin
Total Fee = Base Cost + Overhead + Profit + (Tier Multiplier effect) + Diagnostic Fee`},{id:"value-based",name:"Value-Based Pricing",description:"Pricing based on perceived value to the customer, applying a higher markup for emergency services and complex jobs that require specialized skills.",explanation:"Value-based pricing focuses on what the market will bear rather than solely on costs. This approach recognizes that certain services have higher value to customers in specific situations (like emergency repairs) or when they require specialized expertise (complex jobs). The complexity and emergency factors adjust the base pricing to reflect this increased value. This model works particularly well for businesses with specialized expertise or that offer emergency services.",formula:`Material Fee = Material Cost × Tax × Scale × Markup × Tier × Complexity
Labor Fee = Hours × Hourly Rate × Scale × Tier × Emergency Factor
Total Fee = Material Fee + Labor Fee + Diagnostic Fee`}],selectedCalculationMethod:"standard"}},getters:{currentMarkupScale:e=>e.markupScales[e.selectedMarkupScale],currentServiceTierScale:e=>e.serviceTierScales[e.selectedServiceTierScale],currentJob:e=>e.jobs[e.selectedJob],currentCalculationMethod:e=>e.calculationMethods.find(a=>a.id===e.selectedCalculationMethod),currentJobCategory:e=>{const a=e.jobs[e.selectedJob];if(!a||!a.categoryId)return null;const r={1:{id:1,name:"Plumbing",color:"blue"},2:{id:2,name:"Electrical",color:"amber"},3:{id:3,name:"HVAC",color:"green"},4:{id:4,name:"Appliance",color:"red"}};if(r[a.categoryId])return r[a.categoryId];if(Array.isArray(e.jobCategories)){const o=e.jobCategories.find(i=>i.id===a.categoryId);if(o)return o}return{id:a.categoryId,name:`Category ${a.categoryId}`,color:"grey"}},jobsByCategory:e=>a=>a?e.jobs.filter(r=>r.categoryId===a):e.jobs,jobsByUsage:e=>[...e.jobs].sort((a,r)=>r.usageCount-a.usageCount),jobsByRecent:e=>[...e.jobs].sort((a,r)=>new Date(r.lastUsed)-new Date(a.lastUsed)),mostProfitableMethod:e=>{const a=e.analytics.profitMargins;return Object.keys(a).reduce((r,o)=>a[r]>a[o]?r:o)},mostPreferredTier:e=>{const a=e.jobs,r={1:0,2:0,3:0,4:0,5:0};return a.forEach(o=>{Object.entries(o.tierSelections).forEach(([i,l])=>{r[i]+=l})}),Object.keys(r).reduce((o,i)=>r[o]>r[i]?o:i)},fees:e=>{const a=[],r=Object.entries(e.markupScales[e.selectedMarkupScale].values).map(([d,n])=>[parseFloat(d.slice(1).replace(",","")),n]).sort((d,n)=>d[0]-n[0]),o=Object.entries(e.serviceTierScales[e.selectedServiceTierScale].values).filter(([d])=>!isNaN(parseFloat(d))).map(([d,n])=>[parseInt(d),n]).sort((d,n)=>d[0]-n[0]),i=e.jobs[e.selectedJob];if(!i)return[];const l=e.calculationMethods.find(d=>d.id===e.selectedCalculationMethod);if(!l)return[];const I=e.variables.materialInflation||0,f=i.material*(1+I);for(const[d,n]of o){const t={tier:d};switch(l.id){case"standard":{const s=f*e.variables.salesTax*e.matCostScale,u=S(s,r),c=F(i.seasonalDemand,e.variables.seasonalAdjustment),g=i.requiresCertification?e.variables.certificationBonus:0,p=e.variables.warrantyFactor!==void 0?e.variables.warrantyFactor:0,m=s*u*p*n;t.matCost=s,t.matMarkup=u,t.matFee=s*u*n*c,t.laborFee=i.hours*e.variables.hourlyLaborFee*e.timeCostScale*n,t.warrantyFee=m,t.certificationFee=g,t.totalFee=t.matFee+t.laborFee+e.variables.diagnosticFee+m+g;break}case"cost-plus":{const s=f*e.variables.salesTax*e.matCostScale,u=i.hours*e.variables.hourlyLaborFee*e.timeCostScale,c=l.materialMarkup!==void 0?l.materialMarkup:e.variables.materialMarkup||.4,g=l.laborMarkup!==void 0?l.laborMarkup:e.variables.laborMarkup||.65,p=F(i.seasonalDemand,e.variables.seasonalAdjustment),m=j(i.requiresCertification,e.variables.certificationBonus),b=i.emergencyFactor>1?e.variables.emergencyRate:1,h=M(s*(1+c),e.variables.warrantyFactor,n);t.matCost=s,t.matMarkup=(1+c).toFixed(2),t.matFee=s*(1+c)*n*p,t.laborFee=u*(1+g)*n*(i.emergencyFactor>1?b:1),t.warrantyFee=h,t.certificationFee=m,t.totalFee=t.matFee+t.laborFee+e.variables.diagnosticFee+h+m;break}case"profit-based":{const s=f*e.variables.salesTax*e.matCostScale,u=i.hours*e.variables.hourlyLaborCost*e.timeCostScale,c=s+u,g=F(i.seasonalDemand,e.variables.seasonalAdjustment),p=j(i.requiresCertification,e.variables.certificationBonus);if(c===0){t.matCost=s,t.matMarkup="1.00",t.matFee=0,t.laborFee=0,t.warrantyFee=0,t.certificationFee=p,t.totalFee=e.variables.diagnosticFee+p;break}const m=e.variables.overheadRate||0,b=e.variables.profitMargin||0,h=c*m,y=(c+h)*b,k=c*n-c,$=c*(1+m+b),x=M($,e.variables.warrantyFactor,n);t.matCost=s,t.matMarkup=(1+m+b).toFixed(2),t.overhead=h,t.profit=y;const T=c*(1+m+b)*g,w=s/c,D=u/c;t.matFee=T*w,t.laborFee=T*D+k,t.warrantyFee=x,t.certificationFee=p,t.totalFee=c+h+y+k+e.variables.diagnosticFee+x+p;break}case"value-based":{const s=f*e.variables.salesTax*e.matCostScale,u=S(s,r),c=i.complexity||1,g=i.emergencyFactor||1,p=F(i.seasonalDemand,e.variables.seasonalAdjustment),m=j(i.requiresCertification,e.variables.certificationBonus),b=M(s*u,e.variables.warrantyFactor,n);t.matCost=s,t.matMarkup=u;const h=s*u*n;t.matFee=h*c*p;const y=i.hours*e.variables.hourlyLaborFee*e.timeCostScale;t.laborFee=y*n*g*c,t.warrantyFee=b,t.certificationFee=m,t.totalFee=t.matFee+t.laborFee+e.variables.diagnosticFee+b+m;break}default:{const s=f*e.variables.salesTax*e.matCostScale,u=S(s,r);t.matCost=s,t.matMarkup=u,t.matFee=s*u*n,t.laborFee=i.hours*e.variables.hourlyLaborFee*e.timeCostScale*n,t.totalFee=t.matFee+t.laborFee+e.variables.diagnosticFee}}const v=e.variables.customerDiscount||0;v>0&&(t.discountAmount=t.totalFee*v,t.totalFee=t.totalFee*(1-v));const C=e.variables.minimumJobFee||0;C>0&&t.totalFee<C&&(t.minimumFeeApplied=!0,t.originalFee=t.totalFee,t.totalFee=C),a.push(t)}return a}},actions:{saveState(){localStorage.setItem("menuPriceAppState",JSON.stringify(this.$state))},resetState(){localStorage.removeItem("menuPriceAppState"),this.$reset()},ensureStateIntegrity(){this.$state.jobCategories||(this.$state.jobCategories=[]),[{id:1,name:"Plumbing",color:"blue"},{id:2,name:"Electrical",color:"amber"},{id:3,name:"HVAC",color:"green"},{id:4,name:"Appliance",color:"red"}].forEach(a=>{this.$state.jobCategories.some(o=>o.id===a.id)||this.$state.jobCategories.push(a)})},setMarkupScale(e){this.selectedMarkupScale=e,this.saveState()},setServiceTierScale(e){this.selectedServiceTierScale=e,this.saveState()},setJob(e){this.selectedJob=e;const a=this.jobs[e];a&&(a.usageCount=(a.usageCount||0)+1,a.lastUsed=new Date().toISOString()),this.saveState()},setCalculationMethod(e){this.selectedCalculationMethod=e,this.saveState()},recordTierSelection(e,a){const r=this.jobs.find(o=>o.id===e);r&&r.tierSelections&&r.tierSelections[a]!==void 0&&(r.tierSelections[a]++,this.saveState())},setJobCategory(e){const a=this.jobsByCategory(e);a.length>0&&(this.selectedJob=this.jobs.indexOf(a[0])),this.saveState()},searchJobs(e){return e?this.jobs.filter(a=>a.title.toLowerCase().includes(e.toLowerCase())):this.jobs},updateVariable(e,a){this.variables[e]=a,this.saveState()},setTimeCostScale(e){this.timeCostScale=e,this.saveState()},setMatCostScale(e){this.matCostScale=e,this.saveState()},addJob(e){const a={id:this.nextJobId,title:e.title,material:parseFloat(e.material),hours:parseFloat(e.hours),complexity:parseFloat(e.complexity||1),emergencyFactor:parseFloat(e.emergencyFactor||1),requiresCertification:e.requiresCertification||!1,seasonalDemand:e.seasonalDemand||"medium",categoryId:e.categoryId||1,usageCount:0,lastUsed:new Date().toISOString(),tierSelections:{1:0,2:0,3:0,4:0,5:0}};return this.jobs.push(a),this.nextJobId++,this.saveState(),a.id},updateJob(e,a){const r=this.jobs.findIndex(o=>o.id===e);if(r!==-1){const o=a.tierSelections||this.jobs[r].tierSelections||{1:0,2:0,3:0,4:0,5:0},i=a.usageCount!==void 0?a.usageCount:this.jobs[r].usageCount||0,l=a.lastUsed||this.jobs[r].lastUsed||new Date().toISOString();return this.jobs[r]={...this.jobs[r],...a,material:parseFloat(a.material),hours:parseFloat(a.hours),complexity:parseFloat(a.complexity||1),emergencyFactor:parseFloat(a.emergencyFactor||1),requiresCertification:a.requiresCertification!==void 0?a.requiresCertification:this.jobs[r].requiresCertification||!1,seasonalDemand:a.seasonalDemand||this.jobs[r].seasonalDemand||"medium",categoryId:a.categoryId||this.jobs[r].categoryId||1,tierSelections:o,usageCount:i,lastUsed:l},this.saveState(),!0}return!1},deleteJob(e){const a=this.jobs.findIndex(r=>r.id===e);return a!==-1?(this.jobs.splice(a,1),this.selectedJob>=this.jobs.length&&(this.selectedJob=Math.max(0,this.jobs.length-1)),this.saveState(),!0):!1},addElectricalJobs(){const e=[{title:"Panel Upgrade 100A to 200A",material:850,hours:6,complexity:2.5,emergencyFactor:1.3,requiresCertification:!0,seasonalDemand:"medium",categoryId:2},{title:"Ceiling Fan Installation",material:125,hours:1.5,complexity:1.2,emergencyFactor:1,requiresCertification:!0,seasonalDemand:"high",categoryId:2},{title:"Electrical Troubleshooting",material:50,hours:1,complexity:2,emergencyFactor:1.8,requiresCertification:!0,seasonalDemand:"medium",categoryId:2},{title:"EV Charger Installation",material:650,hours:4,complexity:2,emergencyFactor:1,requiresCertification:!0,seasonalDemand:"high",categoryId:2}];return e.forEach(a=>this.addJob(a)),e.length}}});export{q as u};
